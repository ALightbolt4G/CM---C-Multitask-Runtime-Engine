<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CM Library v4.2.1 - Advanced C Framework Documentation</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #fafbfc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f3f8;
            --bg-code: #0d1117;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-info: #3b82f6;
            --accent-purple: #8b5cf6;
            --border: #e2e8f0;
            --card-shadow: 0 20px 30px -10px rgba(0,0,0,0.1);
            --header-bg: rgba(255,255,255,0.9);
            --code-text: #e2e8f0;
            --table-stripe: #f8fafc;
        }

        body.dark {
            --bg-primary: #0b1120;
            --bg-secondary: #1e293b;
            --bg-tertiary: #2d3a4f;
            --bg-code: #020617;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: #334155;
            --card-shadow: 0 20px 30px -10px rgba(0,0,0,0.6);
            --header-bg: rgba(15,23,42,0.9);
            --code-text: #e2e8f0;
            --table-stripe: #1e293b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.2s;
        }

        /* ===== Header ===== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--header-bg);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo i {
            color: var(--accent-info);
            font-size: 2rem;
        }

        .version {
            background: linear-gradient(135deg, var(--accent-info), var(--accent-purple));
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 30px;
            font-size: 0.9rem;
            margin-left: 1rem;
        }

        /* ===== Mobile Menu Button ===== */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
            margin-right: 1rem;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 0.5rem 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
        }

        /* ===== Layout ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
        }

        /* ===== Sidebar ===== */
        .sidebar {
            position: sticky;
            top: 90px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            background: var(--bg-secondary);
            border-radius: 24px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            transition: left 0.3s ease;
        }

        .sidebar h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav a {
            color: var(--text-secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 12px;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .sidebar-nav a:hover {
            background: var(--bg-tertiary);
            color: var(--accent-info);
            transform: translateX(5px);
        }

        .sidebar-nav .warning {
            color: var(--accent-warning);
        }

        .sidebar-nav .danger {
            color: var(--accent-danger);
        }

        /* ===== Sidebar Overlay ===== */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 90;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* ===== Main Content ===== */
        .main-content {
            min-width: 0;
        }

        .section {
            margin-bottom: 3rem;
            scroll-margin-top: 100px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }

        .section-title i {
            color: var(--accent-info);
            font-size: 1.8rem;
        }

        /* ===== Cards ===== */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            transition: transform 0.2s, border-color 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-info);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .card-header i {
            font-size: 1.5rem;
            color: var(--accent-info);
        }

        .card-header h3 {
            font-size: 1.25rem;
        }

        /* ===== Tables ===== */
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
        }

        .table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            padding: 1rem;
            text-align: left;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background: var(--bg-tertiary);
        }

        /* ===== Code blocks ===== */
        pre {
            background: var(--bg-code);
            color: var(--code-text);
            padding: 1.5rem;
            border-radius: 16px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 1.5rem 0;
            border: 1px solid var(--border);
            max-width: 100%;
        }

        .inline-code {
            background: var(--bg-tertiary);
            color: var(--accent-info);
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        /* ===== Issue badges ===== */
        .issue-severity {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .severity-critical {
            background: #ef4444;
            color: white;
        }

        .severity-high {
            background: #f59e0b;
            color: white;
        }

        .severity-medium {
            background: #3b82f6;
            color: white;
        }

        .severity-low {
            background: #10b981;
            color: white;
        }

        /* ===== Example box ===== */
        .example-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-info);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
        }

        .example-box.warning {
            border-left-color: var(--accent-warning);
        }

        .example-box.danger {
            border-left-color: var(--accent-danger);
        }

        /* ===== Tags ===== */
        .tag {
            display: inline-block;
            padding: 0.2rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-right: 0.5rem;
            background: var(--bg-tertiary);
        }

        .tag-feature {
            background: var(--accent-info);
            color: white;
        }

        .tag-issue {
            background: var(--accent-warning);
            color: white;
        }

        .tag-fixed {
            background: var(--accent-success);
            color: white;
        }

        /* ===== Animations ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        /* ===== Smooth Scroll Native ===== */
        html {
            scroll-behavior: smooth;
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .menu-toggle {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100%;
                width: 280px;
                border-radius: 0 24px 24px 0;
                transition: left 0.3s ease;
                z-index: 100;
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                padding-top: 1rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .card {
                padding: 1rem;
            }

            pre {
                font-size: 0.8rem;
                padding: 1rem;
            }

            .table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }

        @media (max-width: 600px) {
            .header {
                padding: 1rem;
            }

            .header-content {
                gap: 0.5rem;
            }

            .logo {
                font-size: 1.2rem;
            }

            .logo i {
                font-size: 1.5rem;
            }

            .version {
                font-size: 0.7rem;
                padding: 0.2rem 0.6rem;
                margin-left: 0.5rem;
            }

            .theme-toggle {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .example-box {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div style="display: flex; align-items: center;">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <span>CM Library <span class="version">v4.2.1</span></span>
                </div>
            </div>
            <div class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>Dark Mode</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <h3><i class="fas fa-compass"></i> Navigation</h3>
            <ul class="sidebar-nav">
                <li><a href="#overview"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="#quickstart"><i class="fas fa-rocket"></i> Quick Start</a></li>
                <li><a href="#memory-system"><i class="fas fa-memory"></i> Memory System</a></li>
                <li><a href="#arena-allocator"><i class="fas fa-tachometer-alt"></i> Arena Allocator</a></li>
                <li><a href="#garbage-collector"><i class="fas fa-recycle"></i> Garbage Collector</a></li>
                <li><a href="#string-class"><i class="fas fa-font"></i> String Class</a></li>
                <li><a href="#array-class"><i class="fas fa-layer-group"></i> Array Class</a></li>
                <li><a href="#map-class"><i class="fas fa-map"></i> Map Class</a></li>
                <li><a href="#error-handling"><i class="fas fa-exclamation-triangle"></i> Error Handling</a></li>
                <li><a href="#oop-macros"><i class="fas fa-cubes"></i> OOP Macros</a></li>
                <li><a href="#thread-safety"><i class="fas fa-threads"></i> Thread Safety</a></li>
                <li><a href="#known-issues"><i class="fas fa-bug"></i> Known Issues</a></li>
                <li><a href="#solutions"><i class="fas fa-check-double"></i> Solutions</a></li>
                <li><a href="#examples"><i class="fas fa-code"></i> Complete Examples</a></li>
                <li><a href="#api-reference"><i class="fas fa-book"></i> API Reference</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Section -->
            <section id="overview" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-info-circle"></i>
                    <span>Library Overview</span>
                </div>
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-crown"></i>
                        <h3>CM Library - C Multitask Intelligent Framework</h3>
                    </div>
                    <p><strong>Author:</strong> Adham Hossam | <strong>Version:</strong> 4.2.1 | <strong>License:</strong> MIT</p>
                    <p>A comprehensive C framework bringing modern programming paradigms to C:</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
                        <span class="tag tag-feature"><i class="fas fa-check"></i> Dual Memory System</span>
                        <span class="tag tag-feature"><i class="fas fa-check"></i> Garbage Collection</span>
                        <span class="tag tag-feature"><i class="fas fa-check"></i> Arena Allocator</span>
                        <span class="tag tag-feature"><i class="fas fa-check"></i> OOP with Macros</span>
                        <span class="tag tag-feature"><i class="fas fa-check"></i> Exception Handling</span>
                        <span class="tag tag-feature"><i class="fas fa-check"></i> Thread Safety</span>
                        <span class="tag tag-feature"><i class="fas fa-check"></i> Generic Collections</span>
                    </div>
                </div>
            </section>

            <!-- Quick Start -->
            <section id="quickstart" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-hourglass-start"></i>
                    <span>Quick Start</span>
                </div>
                <pre><code>// main.c - Complete working example
#include "CM.h"

int main() {
    // Initialize library (automatic via constructor)
    CM_ABOUT();  // Display banner
    
    // String manipulation
    String* message = String_new("Hello, CM Library!");
    message->upper(message);
    message->print(message);
    printf("\nLength: %d\n", message->length_func(message));
    
    // Array usage
    Array* numbers = Array_new(sizeof(int), 5);
    for(int i = 0; i < 10; i++) {
        numbers->push(numbers, &i);
    }
    
    // Map usage
    Map* config = Map_new();
    int port = 8080;
    config->set(config, "port", &port);
    
    // Cleanup
    String_delete(message);
    Array_delete(numbers);
    Map_delete(config);
    
    // Show GC statistics
    CM_REPORT();
    
    return 0;
}</code></pre>
                <div class="example-box">
                    <i class="fas fa-terminal"></i>
                    <strong>Compilation:</strong>
                    <pre style="margin: 0.5rem 0 0; background: transparent; padding: 0;">gcc main.c CM.c -o program -lpthread -lm</pre>
                </div>
            </section>

            <!-- Memory System -->
            <section id="memory-system" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-memory"></i>
                    <span>Memory System Architecture</span>
                </div>
                <div class="card-grid">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-bolt"></i>
                            <h3>Arena Tier</h3>
                        </div>
                        <p>Fast bump allocator with zero tracking overhead. Perfect for temporary allocations.</p>
                        <ul style="margin-top: 1rem; list-style: none;">
                            <li><i class="fas fa-check" style="color: #10b981;"></i> O(1) allocation</li>
                            <li><i class="fas fa-check" style="color: #10b981;"></i> No GC overhead</li>
                            <li><i class="fas fa-check" style="color: #10b981;"></i> Bulk free</li>
                            <li><i class="fas fa-times" style="color: #ef4444;"></i> No individual free</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-recycle"></i>
                            <h3>GC Tier</h3>
                        </div>
                        <p>Mark & Sweep with reference counting. Thread-safe automatic memory management.</p>
                        <ul style="margin-top: 1rem; list-style: none;">
                            <li><i class="fas fa-check" style="color: #10b981;"></i> Automatic cleanup</li>
                            <li><i class="fas fa-check" style="color: #10b981;"></i> Reference counting</li>
                            <li><i class="fas fa-check" style="color: #10b981;"></i> Destructor support</li>
                            <li><i class="fas fa-check" style="color: #10b981;"></i> Memory tracking</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Arena Allocator with Issues -->
            <section id="arena-allocator" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Arena Allocator - Features & Issues</span>
                </div>
                
                <div class="example-box">
                    <h4>✅ Correct Usage</h4>
                    <pre><code>CMArena* arena = cm_arena_create(1024 * 1024);
cm_arena_push(arena);

// Allocations from arena
char* buffer = (char*)cm_alloc(512, "temp", __FILE__, __LINE__);
int* numbers = (int*)cm_alloc(100 * sizeof(int), "temp", __FILE__, __LINE__);

cm_arena_pop();
cm_arena_destroy(arena);</code></pre>
                </div>

                <div class="example-box warning">
                    <h4>⚠️ CM_WITH_ARENA Macro Issues</h4>
                    <pre><code>// PROBLEM: Memory leak on break/return
CM_WITH_ARENA(4096) {
    char* data = (char*)cm_alloc(100, "temp", __FILE__, __LINE__);
    if (some_condition) {
        break;  // ❌ Arena NOT destroyed! Memory leak!
    }
    if (error) {
        return; // ❌ Arena NOT destroyed! Memory leak!
    }
} // Arena destroyed only on normal exit</code></pre>
                    <p><strong>Issue:</strong> The macro doesn't handle early exits. Arena persists if break/return used.</p>
                </div>

                <div class="example-box">
                    <h4>✅ Safe Arena Pattern</h4>
                    <pre><code>// Solution 1: Manual control
CMArena* temp = cm_arena_create(4096);
cm_arena_push(temp);

// Your code here
if (error) {
    cm_arena_destroy(temp);  // Manual cleanup
    return;
}

cm_arena_pop();
cm_arena_destroy(temp);

// Solution 2: Using cleanup attribute (GNU)
#define CM_WITH_ARENA_SAFE(size) \
    CMArena* _a __attribute__((cleanup(cm_arena_cleanup))) = cm_arena_create(size); \
    if (_a) { cm_arena_push(_a); } \
    for (int _i = (_a ? 1 : 0); _i < 1; _i++)</code></pre>
                </div>
            </section>

            <!-- Garbage Collector -->
            <section id="garbage-collector" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-recycle"></i>
                    <span>Garbage Collector</span>
                </div>
                <pre><code>// Reference counting in action
String* s1 = String_new("shared");
String* s2 = s1;  // Both point to same object
cm_retain(s2);    // Manual retain if needed

cm_free(s1);      // ref_count-- (still alive)
cm_free(s2);      // ref_count-- -> 0, object freed

// Manual GC collection
cm_gc_collect();  // Forces mark & sweep</code></pre>
                
                <table class="table">
                    <tr><th>Function</th><th>Description</th><th>Thread Safety</th></tr>
                    <tr><td>cm_alloc()</td><td>Allocate tracked memory</td><td>✅ Mutex protected</td></tr>
                    <tr><td>cm_free()</td><td>Decrement refcount, free if zero</td><td>✅ Mutex protected</td></tr>
                    <tr><td>cm_retain()</td><td>Increment reference count</td><td>✅ Mutex protected</td></tr>
                    <tr><td>cm_gc_collect()</td><td>Mark & sweep collection</td><td>✅ Mutex protected</td></tr>
                </table>
            </section>

            <!-- String Class with Issues -->
            <section id="string-class" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-font"></i>
                    <span>String Class - OOP Style</span>
                </div>
                
                <div class="example-box warning">
                    <h4>⚠️ Issue: Confusing 'this' parameter name</h4>
                    <pre><code>// Current implementation (problematic for C++)
struct String {
    char* data;
    int length;
    struct String* (*concat)(struct String* this, const char* other);
    //                                    ^^^^ - not reserved but confusing
};

// Usage (works but naming is misleading)
String* s = String_new("hello");
s->concat(s, " world");  // Passing self twice!</code></pre>
                    <p><strong>Issue:</strong> Parameter name 'this' can conflict with C++ and is misleading.</p>
                </div>

                <div class="example-box">
                    <h4>✅ Recommended Naming</h4>
                    <pre><code>// Better: Use 'self' parameter name
struct String {
    char* data;
    int length;
    struct String* (*concat)(struct String* self, const char* other);
    void (*print)(struct String* self);
};

// Clear usage
String* s = String_new("hello");
s->concat(s, " world");  // Still passing self, but parameter named self</code></pre>
                </div>

                <h4>String API Examples</h4>
                <pre><code>String* s = String_new("  Hello CM  ");
s->upper(s);                    // "  HELLO CM  "
s->lower(s);                    // "  hello cm  "
s->concat(s, " Library!");      // "  hello cm  Library!"
printf("Char at 2: %c\n", s->charAt(s, 2));
printf("Length: %d\n", s->length_func(s));
s->print(s);                    // Print to stdout
String_delete(s);</code></pre>
            </section>

            <!-- Array Class -->
            <section id="array-class" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-layer-group"></i>
                    <span>Array Class - Generic Container</span>
                </div>
                <pre><code>// Creating arrays for different types
Array* ints = Array_new(sizeof(int), 10);
Array* strings = Array_new(sizeof(String*), 5);

// Adding elements
int value = 42;
ints->push(ints, &value);

// Retrieving elements
int* retrieved = (int*)ints->get(ints, 0);
printf("Value: %d\n", *retrieved);

// Array info
printf("Size: %d, Capacity: %d\n", ints->size(ints), ints->capacity);

Array_delete(ints);</code></pre>
            </section>

            <!-- Map Class -->
            <section id="map-class" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-map"></i>
                    <span>Map Class - Hash Table</span>
                </div>
                <pre><code>Map* config = Map_new();

// Store different types
int port = 3000;
double timeout = 30.5;
char* host = "localhost";

config->set(config, "port", &port);
config->set(config, "timeout", &timeout);
config->set(config, "host", &host);

// Retrieve values
int* p = (int*)config->get(config, "port");
double* t = (double*)config->get(config, "timeout");
char** h = (char**)config->get(config, "host");

printf("Port: %d\n", *p);
printf("Timeout: %.1f\n", *t);
printf("Host: %s\n", *h);

// Check existence
if (config->has(config, "port")) {
    printf("Port configured\n");
}

Map_delete(config);</code></pre>
            </section>

            <!-- Error Handling with Critical Issues -->
            <section id="error-handling" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Error Handling - CRITICAL ISSUES</span>
                </div>
                
                <div class="example-box danger">
                    <h4>⚠️ CRITICAL: Thread Safety Issue with Exceptions</h4>
                    <pre><code>// Current implementation (DANGEROUS in multi-threaded code)
extern jmp_buf* cm_exception_buffer;  // Global variable - NOT thread safe!

#define CM_TRY() \
    jmp_buf __cm_buf; \
    cm_exception_buffer = &__cm_buf;  // Race condition in threads! \
    if (setjmp(__cm_buf) == 0)

#define CM_THROW(error, message) \
    do { \
        cm_last_error = error; \
        strncpy(cm_error_message, message, sizeof(cm_error_message) - 1); \
        if (cm_exception_buffer) { \
            longjmp(*cm_exception_buffer, error);  // May jump to wrong thread's buffer! \
        } \
    } while(0)</code></pre>
                    <p><strong>Issue:</strong> Global exception buffer causes crashes in multi-threaded code. One thread overwrites another thread's buffer.</p>
                </div>

                <div class="example-box">
                    <h4>✅ Thread-Safe Solution</h4>
                    <pre><code>// In CM.h
extern __thread jmp_buf __cm_exception_buffer;  // Thread-local storage

#define CM_TRY() \
    jmp_buf __cm_buf; \
    jmp_buf* cm_exception_buffer = &__cm_buf;  // Local pointer \
    if (setjmp(__cm_buf) == 0)

#define CM_THROW(error, message) \
    do { \
        cm_last_error = error; \
        strncpy(cm_error_message, message, sizeof(cm_error_message) - 1); \
        jmp_buf* buf_ptr = cm_exception_buffer; \
        if (buf_ptr) { \
            longjmp(*buf_ptr, error); \
        } \
    } while(0)</code></pre>
                </div>

                <h4>Basic Error Handling</h4>
                <pre><code>cmTry {
    int* ptr = NULL;
    if (!ptr) {
        cmThrow(CM_ERROR_NULL_POINTER, "Null pointer detected!");
    }
} cmCatch {
    printf("Error %d: %s\n", cmErrorCode(), cmErrorMsg());
}</code></pre>

                <table class="table">
                    <tr><th>Error Code</th><th>Description</th></tr>
                    <tr><td>CM_SUCCESS</td><td>No error</td></tr>
                    <tr><td>CM_ERROR_MEMORY</td><td>Memory allocation failed</td></tr>
                    <tr><td>CM_ERROR_NULL_POINTER</td><td>Null pointer dereference</td></tr>
                    <tr><td>CM_ERROR_OUT_OF_BOUNDS</td><td>Index out of bounds</td></tr>
                    <tr><td>CM_ERROR_DIVISION_BY_ZERO</td><td>Division by zero</td></tr>
                </table>
            </section>

            <!-- OOP Macros with Issues -->
            <section id="oop-macros" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-cubes"></i>
                    <span>OOP Macros - Implementation Issues</span>
                </div>
                
                <div class="example-box warning">
                    <h4>⚠️ Issues with Current Macros</h4>
                    <pre><code>// Current implementation (problematic)
#define method(class, func, return_type, ...) \
    return_type (*func)(class* this, ##__VA_ARGS__);
    //                                    ^^^^^^^^^^^ - GNU extension, not standard C

// Usage
class(Person) {
    property(char*, name);
    property(int, age);
    method(speak, void);  // Expands to: void (*speak)(Person* this)
} end_class;

// send macro - also uses GNU extension
#define send(obj, func, ...) ((obj)->func(obj, ##__VA_ARGS__))</code></pre>
                    <p><strong>Issues:</strong></p>
                    <ul>
                        <li>##__VA_ARGS__ is a GNU extension (non-standard)</li>
                        <li>'this' parameter name can conflict</li>
                        <li>No compile-time type checking</li>
                    </ul>
                </div>

                <div class="example-box">
                    <h4>✅ Portable Alternative</h4>
                    <pre><code>// Portable version without GNU extensions
#define class(name) typedef struct name name; struct name
#define end_class ;
#define property(type, name) type name;
#define method(name, return_type, ...) return_type (*name)(__VA_ARGS__)

// Cleaner usage
class(Person) {
    property(char*, name);
    property(int, age);
    void (*speak)(Person* self);  // Manual definition
} end_class;

// Implementation
void Person_speak(Person* self) {
    printf("Hi, I'm %s, age %d\n", self->name, self->age);
}

// Initialization
Person* p = cm_alloc(sizeof(Person), "Person", __FILE__, __LINE__);
p->name = "Adham";
p->age = 25;
p->speak = Person_speak;</code></pre>
                </div>
            </section>

            <!-- Thread Safety -->
            <section id="thread-safety" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-threads"></i>
                    <span>Thread Safety Analysis</span>
                </div>
                
                <table class="table">
                    <tr><th>Component</th><th>Thread Safety</th><th>Notes</th></tr>
                    <tr><td>GC Allocations</td><td>✅ Safe</td><td>Protected by mutex</td></tr>
                    <tr><td>GC Collections</td><td>✅ Safe</td><td>Protected by mutex</td></tr>
                    <tr><td>Arena Operations</td><td>✅ Safe</td><td>Protected by mutex</td></tr>
                    <tr><td>String Operations</td><td>⚠️ Conditional</td><td>Safe if using GC functions</td></tr>
                    <tr><td>Array Operations</td><td>⚠️ Conditional</td><td>Safe if using GC functions</td></tr>
                    <tr><td>Map Operations</td><td>⚠️ Conditional</td><td>Safe if using GC functions</td></tr>
                    <tr><td>Exception Handling</td><td>❌ UNSAFE</td><td>Global buffer - use thread-local fix</td></tr>
                </table>

                <div class="example-box">
                    <h4>Thread-Safe Example</h4>
                    <pre><code>#include <pthread.h>
#include "CM.h"

void* thread_func(void* arg) {
    // Each thread gets its own exception buffer (if using thread-local fix)
    cmTry {
        String* s = String_new("Thread-safe string");
        s->print(s);
        String_delete(s);
    } cmCatch {
        printf("Thread error: %s\n", cmErrorMsg());
    }
    return NULL;
}

int main() {
    pthread_t t1, t2;
    pthread_create(&t1, NULL, thread_func, NULL);
    pthread_create(&t2, NULL, thread_func, NULL);
    pthread_join(t1, NULL);
    pthread_join(t2, NULL);
    return 0;
}</code></pre>
                </div>
            </section>

            <!-- Known Issues - Complete List -->
            <section id="known-issues" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-bug"></i>
                    <span>Known Issues & Limitations</span>
                </div>

                <table class="table">
                    <tr>
                        <th>Issue</th>
                        <th>Severity</th>
                        <th>Location</th>
                        <th>Description</th>
                        <th>Solution</th>
                    </tr>
                    <tr>
                        <td>Global exception buffer</td>
                        <td><span class="issue-severity severity-critical">CRITICAL</span></td>
                        <td>CM_TRY/CM_THROW</td>
                        <td>Global jmp_buf pointer causes crashes in multi-threaded code. One thread can overwrite another's buffer.</td>
                        <td>Use thread-local storage (__thread) or pass buffer explicitly</td>
                    </tr>
                    <tr>
                        <td>CM_WITH_ARENA macro leak</td>
                        <td><span class="issue-severity severity-high">HIGH</span></td>
                        <td>arena macros</td>
                        <td>break/continue/return inside macro prevents arena destruction</td>
                        <td>Manual arena management or use cleanup attribute</td>
                    </tr>
                    <tr>
                        <td>this parameter name</td>
                        <td><span class="issue-severity severity-medium">MEDIUM</span></td>
                        <td>OOP macros</td>
                        <td>Parameter name 'this' not reserved but confusing, conflicts with C++</td>
                        <td>Use 'self' instead for clarity</td>
                    </tr>
                    <tr>
                        <td>##__VA_ARGS__ extension</td>
                        <td><span class="issue-severity severity-medium">MEDIUM</span></td>
                        <td>method macro</td>
                        <td>Uses GNU extension, not portable to all compilers</td>
                        <td>Define methods explicitly or use standard variadic macros</td>
                    </tr>
                    <tr>
                        <td>pthread linking on Android</td>
                        <td><span class="issue-severity severity-low">LOW</span></td>
                        <td>build system</td>
                        <td>-lpthread not needed on Android (part of libc)</td>
                        <td>Conditional linking in makefile</td>
                    </tr>
                    <tr>
                        <td>No bounds checking</td>
                        <td><span class="issue-severity severity-medium">MEDIUM</span></td>
                        <td>array_get, string_charAt</td>
                        <td>Some functions lack bounds checking in release mode</td>
                        <td>Always check indices or use debug mode</td>
                    </tr>
                    <tr>
                        <td>Memory fragmentation</td>
                        <td><span class="issue-severity severity-low">LOW</span></td>
                        <td>GC system</td>
                        <td>Repeated allocations/deallocations may fragment memory</td>
                        <td>Use arena for temporary allocations</td>
                    </tr>
                </table>
            </section>

            <!-- Solutions & Best Practices -->
            <section id="solutions" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-check-double"></i>
                    <span>Solutions & Best Practices</span>
                </div>

                <div class="card-grid">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-shield-alt"></i>
                            <h3>Exception Safety</h3>
                        </div>
                        <pre style="margin: 0.5rem 0;">// Thread-local exception handling
__thread jmp_buf __thread_buffer;

#define THREAD_TRY() \
    jmp_buf __local_buf; \
    jmp_buf* __old = &__thread_buffer; \
    __thread_buffer = __local_buf; \
    if (setjmp(__local_buf) == 0)</code></pre>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-broom"></i>
                            <h3>Arena Safety</h3>
                        </div>
                        <pre style="margin: 0.5rem 0;">// Always use manual control
CMArena* arena = cm_arena_create(size);
cm_arena_push(arena);

// Your code with proper cleanup
if (error) {
    cm_arena_destroy(arena);
    return;
}

cm_arena_pop();
cm_arena_destroy(arena);</code></pre>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-code"></i>
                            <h3>Portable OOP</h3>
                        </div>
                        <pre style="margin: 0.5rem 0;">// Avoid macro magic
typedef struct {
    char* data;
    int length;
    void (*print)(void* self);
} String;

void String_print(void* self) {
    String* s = (String*)self;
    printf("%s", s->data);
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Complete Examples -->
            <section id="examples" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-code"></i>
                    <span>Complete Working Examples</span>
                </div>

                <h3>Example 1: Student Management System</h3>
                <pre><code>#include "CM.h"

typedef struct {
    String* name;
    int age;
    double gpa;
} Student;

Student* Student_new(const char* name, int age, double gpa) {
    Student* s = (Student*)cm_alloc(sizeof(Student), "Student", __FILE__, __LINE__);
    s->name = String_new(name);
    s->age = age;
    s->gpa = gpa;
    return s;
}

void Student_delete(Student* s) {
    if (!s) return;
    String_delete(s->name);
    cm_free(s);
}

void Student_print(Student* s) {
    printf("Student: ");
    s->name->print(s->name);
    printf(", Age: %d, GPA: %.2f\n", s->age, s->gpa);
}

int main() {
    CM_ABOUT();
    
    // Create students
    Student* students[3];
    students[0] = Student_new("Adham Hossam", 25, 3.8);
    students[1] = Student_new("John Doe", 22, 3.5);
    students[2] = Student_new("Jane Smith", 23, 3.9);
    
    // Process students
    for(int i = 0; i < 3; i++) {
        Student_print(students[i]);
    }
    
    // Cleanup
    for(int i = 0; i < 3; i++) {
        Student_delete(students[i]);
    }
    
    CM_REPORT();
    return 0;
}</code></pre>

                <h3>Example 2: Arena-Based Temporary Processing</h3>
                <pre><code>#include "CM.h"

void process_batch(int batch_size) {
    // Arena for temporary allocations - automatically freed
    CMArena* temp = cm_arena_create(1024 * 1024);  // 1MB arena
    cm_arena_push(temp);
    
    int* data = (int*)cm_alloc(batch_size * sizeof(int), "temp", __FILE__, __LINE__);
    
    // Process data
    for(int i = 0; i < batch_size; i++) {
        data[i] = i * i;
    }
    
    // Calculate average
    double sum = 0;
    for(int i = 0; i < batch_size; i++) {
        sum += data[i];
    }
    printf("Batch average: %.2f\n", sum / batch_size);
    
    // Arena automatically frees ALL memory
    cm_arena_pop();
    cm_arena_destroy(temp);
}

int main() {
    for(int i = 0; i < 10; i++) {
        process_batch(1000);  // No memory leaks!
    }
    return 0;
}</code></pre>

                <h3>Example 3: Thread-Safe Request Handler</h3>
                <pre><code>#include "CM.h"
#include <pthread.h>
#include <unistd.h>

typedef struct {
    String* method;
    String* path;
    Map* headers;
    String* body;
} Request;

Request* Request_new(const char* method, const char* path) {
    Request* req = (Request*)cm_alloc(sizeof(Request), "Request", __FILE__, __LINE__);
    req->method = String_new(method);
    req->path = String_new(path);
    req->headers = Map_new();
    req->body = NULL;
    return req;
}

void Request_delete(Request* req) {
    if (!req) return;
    String_delete(req->method);
    String_delete(req->path);
    Map_delete(req->headers);
    if (req->body) String_delete(req->body);
    cm_free(req);
}

void* handle_request(void* arg) {
    Request* req = (Request*)arg;
    
    // Thread-local exception handling
    jmp_buf __local_buf;
    jmp_buf* old_buf = cm_exception_buffer;
    cm_exception_buffer = &__local_buf;
    
    if (setjmp(__local_buf) == 0) {
        // Process request
        printf("Processing: ");
        req->method->print(req->method);
        printf(" ");
        req->path->print(req->path);
        printf("\n");
        
        // Add header
        char* content_type = "application/json";
        req->headers->set(req->headers, "Content-Type", &content_type);
    } else {
        printf("Error processing request: %s\n", cm_error_get_message());
    }
    
    cm_exception_buffer = old_buf;
    Request_delete(req);
    return NULL;
}

int main() {
    pthread_t threads[5];
    
    for(int i = 0; i < 5; i++) {
        Request* req = Request_new("GET", "/api/data");
        pthread_create(&threads[i], NULL, handle_request, req);
    }
    
    for(int i = 0; i < 5; i++) {
        pthread_join(threads[i], NULL);
    }
    
    return 0;
}</code></pre>
            </section>

            <!-- API Reference -->
            <section id="api-reference" class="section fade-in">
                <div class="section-title">
                    <i class="fas fa-book"></i>
                    <span>Complete API Reference</span>
                </div>

                <h3>Memory Management</h3>
                <table class="table">
                    <tr><th>Function</th><th>Description</th></tr>
                    <tr><td>void* cm_alloc(size_t size, const char* type, const char* file, int line)</td><td>Allocate GC-tracked memory</td></tr>
                    <tr><td>void cm_free(void* ptr)</td><td>Decrement refcount, free if zero</td></tr>
                    <tr><td>void cm_retain(void* ptr)</td><td>Increment reference count</td></tr>
                    <tr><td>void cm_gc_collect(void)</td><td>Force garbage collection</td></tr>
                    <tr><td>void cm_gc_stats(void)</td><td>Print GC statistics</td></tr>
                </table>

                <h3>Arena Allocator</h3>
                <table class="table">
                    <tr><th>Function</th><th>Description</th></tr>
                    <tr><td>CMArena* cm_arena_create(size_t size)</td><td>Create new arena</td></tr>
                    <tr><td>void cm_arena_destroy(CMArena* arena)</td><td>Destroy arena and free all memory</td></tr>
                    <tr><td>void cm_arena_push(CMArena* arena)</td><td>Set as current arena</td></tr>
                    <tr><td>void cm_arena_pop(void)</td><td>Remove current arena</td></tr>
                </table>

                <h3>String API</h3>
                <table class="table">
                    <tr><th>Function</th><th>Description</th></tr>
                    <tr><td>String* String_new(const char* initial)</td><td>Create new string</td></tr>
                    <tr><td>void String_delete(String* self)</td><td>Free string</td></tr>
                    <tr><td>String* string_concat(String* self, const char* other)</td><td>Concatenate string</td></tr>
                    <tr><td>String* string_upper(String* self)</td><td>Convert to uppercase</td></tr>
                    <tr><td>String* string_lower(String* self)</td><td>Convert to lowercase</td></tr>
                    <tr><td>void string_print(String* self)</td><td>Print to stdout</td></tr>
                    <tr><td>int string_length(String* self)</td><td>Get string length</td></tr>
                    <tr><td>char string_charAt(String* self, int index)</td><td>Get character at index</td></tr>
                    <tr><td>String* cm_input(const char* prompt)</td><td>Read input from user</td></tr>
                </table>

                <h3>Array API</h3>
                <table class="table">
                    <tr><th>Function</th><th>Description</th></tr>
                    <tr><td>Array* Array_new(int element_size, int capacity)</td><td>Create new array</td></tr>
                    <tr><td>void Array_delete(Array* self)</td><td>Free array</td></tr>
                    <tr><td>Array* array_push(Array* self, void* value)</td><td>Add element to end</td></tr>
                    <tr><td>void* array_pop(Array* self)</td><td>Remove and return last element</td></tr>
                    <tr><td>void* array_get(Array* self, int index)</td><td>Get element at index</td></tr>
                    <tr><td>int array_size(Array* self)</td><td>Get current size</td></tr>
                </table>

                <h3>Map API</h3>
                <table class="table">
                    <tr><th>Function</th><th>Description</th></tr>
                    <tr><td>Map* Map_new(void)</td><td>Create new map</td></tr>
                    <tr><td>void Map_delete(Map* self)</td><td>Free map</td></tr>
                    <tr><td>Map* map_set(Map* self, const char* key, void* value)</td><td>Set key-value pair</td></tr>
                    <tr><td>void* map_get(Map* self, const char* key)</td><td>Get value by key</td></tr>
                    <tr><td>int map_has(Map* self, const char* key)</td><td>Check if key exists</td></tr>
                    <tr><td>int map_size_func(Map* self)</td><td>Get number of entries</td></tr>
                </table>

                <h3>Error Handling</h3>
                <table class="table">
                    <tr><th>Function/Macro</th><th>Description</th></tr>
                    <tr><td>cmTry</td><td>Start try block</td></tr>
                    <tr><td>cmCatch</td><td>Start catch block</td></tr>
                    <tr><td>cmThrow(error, message)</td><td>Throw exception</td></tr>
                    <tr><td>const char* cm_error_string(int error)</td><td>Get error description</td></tr>
                    <tr><td>const char* cm_error_get_message(void)</td><td>Get last error message</td></tr>
                    <tr><td>int cm_error_get_last(void)</td><td>Get last error code</td></tr>
                </table>

                <h3>Utility Functions</h3>
                <table class="table">
                    <tr><th>Function</th><th>Description</th></tr>
                    <tr><td>void cm_random_seed(unsigned int seed)</td><td>Seed random generator</td></tr>
                    <tr><td>void cm_random_string(char* buffer, size_t length)</td><td>Generate random string</td></tr>
                    <tr><td>CM_ABOUT()</td><td>Display library info</td></tr>
                    <tr><td>CM_REPORT()</td><td>Show GC statistics</td></tr>
                </table>
            </section>

            <!-- Footer -->
            <section style="margin-top: 3rem; text-align: center; padding: 2rem; border-top: 1px solid var(--border);">
                <i class="fas fa-cube" style="font-size: 3rem; color: var(--accent-info); opacity: 0.5;"></i>
                <p style="margin-top: 1rem; color: var(--text-muted);">
                    CM Library v4.2.1 by Adham Hossam<br>
                    MIT License - 2026<br>
                    <span class="tag"><i class="fab fa-github"></i> ALightbolt4G/CM</span>
                </p>
            </section>
        </main>
    </div>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        function setTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
            } else {
                body.classList.remove('dark');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
            }
            localStorage.setItem('cm-theme', theme);
        }

        setTheme(localStorage.getItem('cm-theme') || 'light');

        themeToggle.addEventListener('click', () => {
            setTheme(body.classList.contains('dark') ? 'light' : 'dark');
        });

        // Mobile Sidebar
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');

        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            });
        }

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Close sidebar after click (mobile)
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 1024) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                }
            });
        });

        // Intersection Observer for fade-in
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.section:not(.fade-in)').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>